# Etapa 1: Build da aplicação
FROM rust:1.75 as builder

# Definir diretório de trabalho
WORKDIR /app

# Copiar arquivos de dependências para cache
COPY Cargo.toml Cargo.lock ./
COPY src ./src

# Compilar a aplicação em modo release
RUN cargo build --release

# Etapa 2: Imagem mínima para execução
FROM gcr.io/distroless/cc

# Definir diretório de trabalho
WORKDIR /app

# Copiar o binário compilado
COPY --from=builder /app/target/release/back-end .

# Expor porta da aplicação
EXPOSE 8080

# Comando de inicialização
CMD ["./back-end"]
